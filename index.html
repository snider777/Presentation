<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Modelo con Im√°genes y Dedicatoria</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: white;
      font-family: 'Poppins', sans-serif;
    }
    #scrollContainer {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      overflow-y: auto;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 40px;
      font-size: 20px;
      z-index: 2;
    }
    #dedicatoria {
      margin-top: 20px;
      font-size: 20px;
      white-space: pre-wrap;
      max-width: 800px;
      min-height: 32px;
    }
    #imagenDisplay {
      max-width: 80vw;
      max-height: 60vh;
      border-radius: 10px;
      box-shadow: 0 0 20px #ff4da6;
    }
    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 0;
      pointer-events: none;
      display: block;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js"></script>
</head>
<body>
  <audio id="bgMusic" src="could.mp3" preload="auto"></audio>
  <div id="scrollContainer">
    <!-- Imagen que cambia seg√∫n estado -->
    <img id="imagenDisplay" src="" alt="" style="display:none" />
    <div id="textoImagen" style="color:#ff4da6; font-weight:600; margin-top:10px; min-height:30px;"></div>
    <div id="dedicatoria"></div>
  </div>
  <script>
    let frases = ["En fin ...", "Comencemos ..."];
    let clickCount = 0;
    let fraseIndex = 0;
    let gotas = [];
    let particulas = [];
    let particulasLluviaActiva = true;

    let mostrarSecuenciaImagenes = false;
    let indiceImagenActual = 0;
    // Array con objeto {src, texto, duracionMS}
    const secuenciaImagenes = [
      { src: "imagen.jpg", texto: "Mi ni√±a de ojos bonitos", duracion: 6000 },
      { src: "imagen2.jpg", texto: "Extra√±o a esa loquita :(", duracion: 8000 },
      { src: "imagen3.jpg", texto: "", duracion: 7000 },
      { src: "imagen4.jpg", texto: "Recuerdas cuando fuimos a tu casa???", duracion: 7000 }
    ];
    let tiempoInicioImagen = 0;

    let mostrarDedicatoria = false;
    let textoBase = "Hola, se que no quieres hablar conmigo, espero est√©s bien, yo no me siento bien,  no puedo estar sin ti, en vdd t quiero mucho Antonella :( y bueno yo s√© q t√∫ tmb como amigo :) pero a√∫n una parte tuya siente algo x mi tal vez muy en el fondo pero yo s√© q si, y tienes miedo de demostrarlo y te entiendo x todo lo q me contaste, solo quiero q sepas q nunca t har√≠a da√±o, en vdd quiero hacerte la mujer m√°s feliz, as√≠ como t√∫ me hac√≠as feliz :( eres mi lugar seguro, a la √∫nica q le he podido contar cosas q nadie mas sabe, solo tu sabes lo q pas√≥ en mi infancia, y todo lo q te conte, recuerdas nuestro primer beso? Nuestra primera salida? Recuerdas que un tiempo me quer√≠as demasiado? Y no quer√≠as alejarte? Estoy seguro q el amor que me tuviste no se fue de la noche a la ma√±ana, es x tu miedo q siempre tuviste, en vdd por todo lo q pasamos nos merecemos una segunda oportunidad donde tod salga bien mi princesita:( te prometi que pase lo q pase siempre iba luchar y buscar soluciones a nuestros problemas x m√°s malos q sean :( y estoy ac√° cumpliendolo, no he comido hace dos d√≠as lit todo esto me tiene mal :( lo √∫nico q deseo es vuelvas y me tengas en tus brazos como antes, te quiero mucho mi princesita ü•Ä, dejemos de estar as√≠, no me gusta y creo q a ti tmpco volvamos a ser esos que no pod√≠an estar sin el otro, esos dos loquitos , mi ni√±a intentemoslo solo una vez, yo s√© q t√∫ puedes hacerlo y puedes quitarte ese miedo, porfa mi antoü•Ä, sabes q apesar d todo siempre contar√°s conmigo:') siempre t escuchar√© y sea lo q sea nunca t juzgare, te extra√±o demasiado, es dif√≠cil verte solo de lejos :(";
    let textoVisible = "";
    let indexLetra = 0;
    let tiempoEscritura = 0;
    const velocidadEscritura = 100;
    let coloresTexto = ["#ff8080", "#ff4da6", "#ff00ff"];
    let coloresPorLetra = [];

    // Elementos DOM
    const imagenDisplay = document.getElementById("imagenDisplay");
    const textoImagen = document.getElementById("textoImagen");
    const dedicatoriaElem = document.getElementById("dedicatoria");

    function crearParticulas() {
      particulas = [];
      for (let i = 0; i < 100; i++) {
        particulas.push({
          x: random(width),
          y: random(height),
          dx: random(-0.3, 0.3),
          dy: random(-0.3, 0.3),
          size: random(2, 4),
          alpha: random(150, 255),
          color: random(coloresTexto)
        });
      }
    }

    function hexToRgb(hex){
      const res = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return res ? {
        r: parseInt(res[1], 16),
        g: parseInt(res[2], 16),
        b: parseInt(res[3], 16)
      } : null;
    }

    function moverYdibujarParticulas(){
      for(let p of particulas){
        p.x += p.dx;
        p.y += p.dy;

        if(p.x < 0 || p.x > width) p.dx *= -1;
        if(p.y < 0 || p.y > height) p.dy *= -1;

        const c = hexToRgb(p.color);
        if(c){
          fill(c.r, c.g, c.b, p.alpha);
        }else{
          fill(255, p.alpha);
        }
        noStroke();
        ellipse(p.x, p.y, p.size);
      }
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      let c=document.querySelector("canvas");
      c.style.width = "100vw";
      c.style.height = "100vh";
      textSize(26);
      textAlign(CENTER, CENTER);
      textFont('Poppins');
      crearParticulas();

    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      let c=document.querySelector("canvas");
      c.style.width = "100vw";
      c.style.height = "100vh";
      crearParticulas();
    }

    function mousePressed() {
      if(clickCount === 0){ 
        // El audio arranca en primer click
        const audio = document.getElementById("bgMusic");
        audio.play();
      }
      clickCount++;

      if(!mostrarSecuenciaImagenes && !mostrarDedicatoria){
        if(clickCount % 2 == 0){
          fraseIndex = (fraseIndex + 1) % frases.length;  
          for(let g of gotas){
            g.texto = frases[fraseIndex];
          }
        }
        if(clickCount >= 30){
          mostrarSecuenciaImagenes = true;
          tiempoInicioImagen = millis();
          indiceImagenActual = 0;
          // Inicializar primera imagen
          imagenDisplay.src = secuenciaImagenes[0].src;
          imagenDisplay.style.display = "block";
          textoImagen.textContent = secuenciaImagenes[0].texto;
          dedicatoriaElem.textContent = "";
          crearParticulas();
        }
        // Explosi√≥n de gotas en click
        for(let i=0; i < 20; i++){
          let ang = random(TWO_PI);
          let speed = random(2,6);
          gotas.push({
            x: mouseX,
            y: mouseY,
            dx: cos(ang)*speed,
            dy: sin(ang)*speed,
            texto: frases[fraseIndex],
            alpha: 255,
            explosion: true
          });
        }
      }
    }

    function draw() {
      background(0, 100);
      moverYdibujarParticulas();

      if(!mostrarSecuenciaImagenes && !mostrarDedicatoria){
        // Lluvia frases
        textAlign(CENTER, CENTER);
        textSize(24);

        if(frameCount % 8 === 0){
          gotas.push({
            x: random(width),
            y: -30,
            speed: random(2,4),
            alpha: 255,
            texto: frases[fraseIndex],
            explosion: false
          });
        }
        
        for(let i = gotas.length -1; i >= 0; i--){
          let g = gotas[i];
          let c = hexToRgb(random(coloresTexto));
          if(c){
            fill(c.r, c.g, c.b, g.alpha);
          }else{
            fill(255,g.alpha);
          }
          text(g.texto, g.x, g.y);

          if(g.explosion){
            g.x += g.dx;
            g.y += g.dy;
            g.alpha -= 5;
          }else{
            g.y += g.speed;
            g.alpha -= 1.5;
          }

          if(g.alpha <= 0 || g.y > height + 50){
            gotas.splice(i,1);
          }
        }

        imagenDisplay.style.display = "none";
        textoImagen.textContent = "";
        dedicatoriaElem.textContent = "";
        
      }else if(mostrarSecuenciaImagenes){
        // Mostrar imagen y texto ciclo
        let tiempoPasado = millis() - tiempoInicioImagen;
        let current = secuenciaImagenes[indiceImagenActual];
        
        imagenDisplay.style.display = "block";
        imagenDisplay.src = current.src;
        textoImagen.textContent = current.texto;

        if(tiempoPasado >= current.duracion){
          indiceImagenActual++;
          if(indiceImagenActual >= secuenciaImagenes.length){
            // Termina secuencia im√°genes ‚Üí dedicatoria
            mostrarSecuenciaImagenes = false;
            mostrarDedicatoria = true;
            textoVisible = "";
            indexLetra = 0;
            tiempoEscritura = millis();
            imagenDisplay.style.display = "none";
            textoImagen.textContent = "";
            crearParticulas();
          }else{
            // Siguiente imagen
            tiempoInicioImagen = millis();
            imagenDisplay.src = secuenciaImagenes[indiceImagenActual].src;
            textoImagen.textContent = secuenciaImagenes[indiceImagenActual].texto;
          }
        }
      }else if(mostrarDedicatoria){
        imagenDisplay.style.display = "none";
        textoImagen.textContent = "";

        if(millis() - tiempoEscritura > velocidadEscritura && indexLetra < textoBase.length){
          textoVisible += textoBase[indexLetra];
          indexLetra++;
          tiempoEscritura = millis();
        }

        while(coloresPorLetra.length < textoVisible.length){
          coloresPorLetra.push(random(coloresTexto));
        }
        while(coloresPorLetra.length > textoVisible.length){
          coloresPorLetra.pop();
        }
        if(frameCount % 4 === 0){
          for(let i=0;i<coloresPorLetra.length;i++){
            coloresPorLetra[i] = random(coloresTexto);
          }
        }

        let html = "";
        for(let i=0;i<textoVisible.length;i++){
          html += `<span style="color:${coloresPorLetra[i]}">${textoVisible[i]}</span>`;
        }
        dedicatoriaElem.innerHTML = html;
      }
    }
  </script>
</body>
</html>
